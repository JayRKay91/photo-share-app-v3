<!-- templates/gallery.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Photo Gallery</title>
  <!-- Tier¬†1: Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Main stylesheet includes card, hover, color scheme, typography, etc. -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/gallery.css') }}">
</head>
<body>
  <div class="layout-wrapper">
    <div class="app-container">
      <!-- Collapsible Sidebar for Albums & Tags -->
      <aside class="sidebar collapsed">
        <button class="sidebar-toggle" aria-label="Toggle navigation">‚ò∞</button>
        <h2>Navigation</h2>
        <nav>
          <h3>Albums</h3>
          <ul>
            <li><a href="{{ url_for('main.index') }}">All</a></li>
            {% for alb in albums_list %}
              <li><a href="{{ url_for('main.index', album=alb) }}">{{ alb }}</a></li>
            {% endfor %}
          </ul>
          <h3>Tags</h3>
          <ul>
            {% for tag in all_tags %}
              <li><a href="{{ url_for('main.index', tag=tag) }}">{{ tag }}</a></li>
            {% endfor %}
          </ul>
        </nav>
      </aside>

      <div class="content">
        <!-- Header with Title & Upload Button -->
        <header class="page-header">
          <h1>Photo Gallery</h1>
          <button class="btn btn-primary"
                  onclick="location.href='{{ url_for('main.upload') }}'">
            ‚ûï¬†Upload New Photo
          </button>
        </header>

        <!-- Search Bar -->
        <section class="controls">
          <form action="{{ url_for('main.index') }}" method="get" class="search-form">
            <input
              type="search"
              name="search"
              placeholder="Search by filename, description, album, or tag‚Ä¶"
              value="{{ search_query }}"
              aria-label="Search gallery"
            >
            <button type="submit" class="btn btn-secondary">üîç</button>
          </form>
        </section>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <ul class="flashes">
              {% for category, msg in messages %}
                <li class="flash-{{ category }}">{{ msg }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}

        <!-- Gallery Grid with Cards -->
        <main class="gallery-grid">
          {% for img in images %}
            <figure class="gallery-item card">
              {% if img.type == 'video' %}
                <div class="media-wrapper">
                  <img
                    src="{{ url_for('static', filename=img.thumb) }}"
                    alt="Thumbnail for {{ img.filename }}"
                    class="clickable"
                    data-full="{{ url_for('static', filename='uploads/' + img.filename) }}"
                    data-type="video"
                    onerror="handleError(this)"
                  >
                  <div class="play-overlay" aria-hidden="true">‚ñ∫</div>
                </div>
              {% else %}
                <img
                  src="{{ url_for('static', filename='uploads/' + img.filename) }}"
                  alt="{{ img.description or img.filename }}"
                  class="clickable"
                  data-full="{{ url_for('static', filename='uploads/' + img.filename) }}"
                  data-type="image"
                  onerror="handleError(this)"
                >
              {% endif %}

              <div class="caption">
                {% if img.album %}
                  <p class="album-label">üìÅ¬†{{ img.album }}</p>
                {% endif %}
                <!-- description, tags, and action forms‚Ä¶ -->
              </div>
            </figure>
          {% else %}
            <p class="empty">No photos yet‚Äîbe the first to upload one!</p>
          {% endfor %}
        </main>
      </div>
    </div>
  </div>

  <!-- Lightbox Overlay with Navigation -->
  <div id="preview" aria-hidden="true" onclick="closePreview()">
    <button class="close-btn" aria-label="Close" onclick="closePreview()">√ó</button>
    <button class="nav-btn prev-btn" aria-label="Previous" onclick="navigate(-1)">‚Äπ</button>
    <div class="preview-box" onclick="event.stopPropagation()"></div>
    <button class="nav-btn next-btn" aria-label="Next" onclick="navigate(1)">‚Ä∫</button>
  </div>

  <!-- Sidebar toggle script -->
  <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
  <!-- Gallery lightbox script -->
  <script src="{{ url_for('static', filename='js/gallery.js') }}"></script>
</body>
</html>
